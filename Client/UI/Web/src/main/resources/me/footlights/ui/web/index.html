<html>
	<head>
		<title>Footlights</title>
		<link rel="stylesheet" type="text/css" href="/static/footlights/style/footlights.css"/>

		<script type="text/javascript" src="/static/footlights/ses/whitelist.js"></script>
		<script type="text/javascript" src="/static/footlights/ses/atLeastFreeVarNames.js"></script>
		<script type="text/javascript" src="/static/footlights/ses/WeakMap.js"></script>
		<script type="text/javascript" src="/static/footlights/ses/initSES.js"></script>

		<script type="text/javascript" src="/static/footlights/dom-proxy.js"></script>
		<script type="text/javascript" src="/static/footlights/sandboxes.js"></script>

		<script type="text/javascript" src="/static/footlights/ajax.js"></script>
	</head>
	
	<body>
		<h1>Footlights</h1>

		<div id="root">
			<div id="launcher"></div>
			<div id="status"></div>
			<div id="content"></div>
		</div>

		<script type="text/javascript">
'use strict';
initSES(window, whitelist, atLeastFreeVarNames);

(function init()
{
	// Set up logging (nice user-visible log box).
	var status = document.getElementById('status');
	status.log = function logToStatusDiv(t)
	{
		var update = document.createElement('p');
		this.insertBefore(update, this.firstChild);

		var dateStamp = document.createElement('div');
		dateStamp.appendChild(document.createTextNode(new Date().toUTCString()));
		dateStamp.className = 'timestamp';

		update.appendChild(dateStamp);
		update.appendChild(document.createTextNode(t));
	};

	function log(message)
	{
		console.log(message);
		status.log(message);
	}
	var rootContext = sandboxes.wrap('global', log);
	rootContext.root = proxy(document.getElementById('root'), rootContext);

	// The root context has no inherent privileges: we must pass special things in.
	rootContext.globals['sandboxes'] = sandboxes;
	rootContext.globals['window'] = window;
	['content', 'status', 'launcher'].forEach(function addAppLink(name) {
		rootContext.globals[name] = proxy(document.getElementById(name), rootContext);
	});

	// A function which sets up a channel for asychronous events.
	function setupAsyncChannel() {
		setTimeout(function openAsyncChannel() { rootContext.ajax('async_channel'); }, 0);
	}
	rootContext.globals['setupAsyncChannel'] = setupAsyncChannel;

	sandboxes['global'] = Object.freeze(rootContext);

	rootContext.ajax('init');
})();
		</script>


		<!--
		<iframe src="Footlights.jnlp" height="1" style="border: none"/>
		-->
	</body>
</html>
